# 视频剪辑编辑器更新说明

## 已完成的功能更新

### 1. ✅ 视频轨道帧预览
- 使用 Canvas 渲染视频片段的每一帧预览
- 每个视频片段显示多个缩略帧（每40px一帧，最多20帧）
- 自动适配视频宽高比，居中裁剪显示
- 裁剪视频时自动重新渲染帧预览

**实现细节：**
- `renderClipFrames()` 函数负责渲染
- 使用 `<canvas>` 元素替代 `<video>` 标签
- 通过 `video.currentTime` 和 `video.onseeked` 精确捕获每一帧

### 2. ✅ 播放控制移至时间线工具栏
- 从顶部工具栏移除播放/暂停按钮
- 在时间线工具栏添加播放控制组
- 新增"从此处播放"按钮，可从当前播放头位置开始播放

**按钮布局：**
```
[播放] [暂停] [从此处播放] | [撤销] [重做] | [缩放控制] | [添加音频轨道]
```

### 3. ✅ 视频裁剪功能
- 拖拽片段左右边缘可裁剪视频
- 支持精确的开始/结束时间调整
- 裁剪后自动更新片段时长和位置
- 属性面板可精确输入裁剪时间点

**裁剪逻辑：**
- 左边缘：调整 `startTime` 和 `position`
- 右边缘：调整 `endTime`
- 最小片段时长：0.1秒

### 4. ✅ 撤销/重做功能
- 完整的历史记录管理系统
- 支持最多50步操作历史
- 自动保存以下操作：
  - 添加/删除片段
  - 移动片段
  - 裁剪片段
  - 设置转场效果

**快捷键建议：**
- Ctrl+Z / Cmd+Z: 撤销
- Ctrl+Shift+Z / Cmd+Shift+Z: 重做

### 5. ✅ 时间线高度调整
- 时间线区域高度：300px → **400px**
- 每个轨道高度：80px → **65px**
- 视频片段高度：64px → **65px**（填满轨道）

### 6. ✅ 转场效果
- 点击视频片段拼接处显示转场指示器（黄色圆形图标）
- 点击指示器打开转场设置对话框
- 支持的转场类型：
  - 无转场
  - 淡入淡出
  - 溶解
  - 擦除
  - 滑动
- 可调整转场时长（0.3-3秒）

**转场指示器：**
- 位置：两个视频片段之间
- 样式：黄色圆形，悬停时放大
- 显示当前转场类型（tooltip）

## 技术实现

### Canvas 帧渲染
```typescript
const renderClipFrames = async (clip: TimelineClip, canvas: HTMLCanvasElement) => {
  // 1. 创建临时 video 元素
  // 2. 计算需要渲染的帧数
  // 3. 逐帧 seek 并绘制到 canvas
  // 4. 自动适配宽高比
}
```

### 历史记录系统
```typescript
interface HistoryState {
  videoTracks: TimelineClip[][]
  audioTracks: TimelineClip[][]
}

// 深拷贝状态
const saveHistory = () => {
  const state = JSON.parse(JSON.stringify({
    videoTracks: videoTracks.value,
    audioTracks: audioTracks.value,
  }))
  history.value.push(state)
}
```

### 转场效果
```typescript
interface TimelineClip {
  // ...其他属性
  transition?: {
    type: string      // 转场类型
    duration: number  // 转场时长
  }
}
```

## 界面优化

### 工具栏布局
```
时间线工具栏：
┌─────────────────────────────────────────────────────────┐
│ [播放控制] [历史控制] [缩放控制] [轨道控制]              │
└─────────────────────────────────────────────────────────┘
```

### 视频片段显示
```
┌─────────────────────────────────────┐
│ [帧1][帧2][帧3][帧4][帧5]...        │ ← Canvas 渲染的帧预览
│                                     │
│ 片段名称                            │ ← 底部显示名称
└─────────────────────────────────────┘
```

### 转场指示器
```
[视频片段1] ⚠️ [视频片段2]
            ↑
         转场指示器
```

## 注意事项

1. **性能优化**
   - 帧渲染是异步操作，大量视频可能影响性能
   - 建议限制同时渲染的片段数量
   - 可考虑添加加载状态提示

2. **国际化**
   - 按要求移除了国际化支持
   - 所有文本使用中文硬编码

3. **浏览器兼容性**
   - Canvas API 需要现代浏览器支持
   - 视频 seek 操作在某些浏览器可能不够精确

4. **未来扩展**
   - 转场效果目前仅保存配置，实际渲染需要 FFmpeg 支持
   - 可添加转场预览功能
   - 可优化帧渲染算法，使用 WebWorker

## 使用示例

1. **导入视频**
   - 点击"导入视频"按钮
   - 选择视频文件

2. **添加到轨道**
   - 拖拽视频到视频轨道
   - 自动显示帧预览

3. **裁剪视频**
   - 拖拽片段左右边缘
   - 或在属性面板精确输入

4. **设置转场**
   - 点击两个片段之间的黄色圆形图标
   - 选择转场类型和时长

5. **撤销/重做**
   - 点击工具栏的撤销/重做按钮
   - 或使用快捷键

## 测试建议

- [ ] 测试不同分辨率的视频帧渲染
- [ ] 测试大量片段的性能表现
- [ ] 测试撤销/重做的边界情况
- [ ] 测试转场设置的保存和显示
- [ ] 测试裁剪后的帧预览更新
